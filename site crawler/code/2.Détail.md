# Crawler

Pas à pas

## Analyse

Restent à faire:

* URL saisie est correcte
* Les URLs de la page sont toutes absolues
* Pour l'instant on code en dur utilisateur et mot de passe de la BDD.
* traitement URL non complètes
* Traitement BDD
* Faire sauter les limites horizontales de récursion

à faire
modèle de données
connexion et insertion BDD
vérifier si la bdd existe comme souhaité et la créer si besoin

~~1. On a une URL. On la stocke dans un objet de type `URLWords` qui s'appelle `niveau1`.~~
~~2. On récupère la page associée.~~
~~3. On la traite avec BeautifulSoup.~~
  ~~* On peut créer un objet de type `page` avec ça.~~
~~4. On récupère tous les liens et on les mets dans une liste, `liens1`.~~
~~5. On récupère les mots dans la page et leur occurrence.~~
~~6. On boucle sur tous les mots pour avoir la somme des occurrences.~~
~~7. On calcule le pourcentage de présence de chaque mot.~~
~~8. On ouvre une boucle qui prend toutes les url contenues dans `liens1`. Pour chaque url dans `liens1`:~~
  ~~1. On la stocke dans un objet de type `URLWords` qui s'appelle `1` (puis `2`...).~~
  ~~2. On récupère la page associée.~~
  ~~3. On la traite avec BeautifulSoup.~~
  ~~4. On récupère tous les liens et on les mets dans une liste, `liens2`.~~
  ~~5. On récupère les mots dans la page et leur occurrence.~~
  ~~6. On boucle sur tous les mots pour avoir la somme des occurrences.~~
  ~~7. On calcule le pourcentage de présence de chaque mot.~~
  ~~8. On stocke l'objet de type `URLWords` dans `niveau2`.~~
~~9. Une fois la boucle finie, on la refait avec la liste `liens2`. Pour chaque url:~~
  ~~1. On la stocke dans un objet de type `URLWords` qui s'appelle `1` (puis `2`...).~~
  ~~2. On récupère la page associée.~~
  ~~3. On la traite avec BeautifulSoup.~~
  ~~4. On récupère les mots dans la page et leur occurrence.~~
  ~~5. On boucle sur tous les mots pour avoir la somme des occurrences.~~
  ~~6. On calcule le pourcentage de présence de chaque mot.~~
  ~~7. On stocke l'objet de type `URLWords` dans `niveau2`.~~

## Affichage

Une fois l'analyse finie, on affiche les résultats. Pour ce faire:

1. On dispose d'un template qui représente un résultat d'analyse d'une page.
*Exemple*:
```
URL: {{ici va la variable url}}
mot 1: {{ici va le mot le plus présent}}
  occurrences: {{ici va le nombre d'occurrences}}
  pourcentage: {{ici va le pourcentage d'occurrences}}
mot 2: {{ici va le deuxième mot le plus présent}}
  occurrences: {{ici va le nombre d'occurrences}}
  pourcentage: {{ici va le pourcentage d'occurrences}}
mot 3: {{ici va le troisième mot le plus présent}}
  occurrences: {{ici va le nombre d'occurrences}}
  pourcentage: {{ici va le pourcentage d'occurrences}}
```
2. On récupère les variables de niveau1
```
URL: {{niveau1.url}}
mot 1: {{niveau1.wordsitems[0][0]}}
  occurrences: {{niveau1.wordsitems[0][1]}}
  pourcentage: {{niveau1.wordsitems[0][2]}}
mot 2: {{niveau1.wordsitems[1][0]}}
    occurrences: {{niveau1.wordsitems[1][1]}}
    pourcentage: {{niveau1.wordsitems[1][2]}}
mot 3: {{niveau1.wordsitems[2][0]}}
      occurrences: {{niveau1.wordsitems[2][1]}}
      pourcentage: {{niveau1.wordsitems[2][2]}}
```

3. On boucle sur `niveau2` et `niveau3`.
  * On teste si le mots (`mot1`, `mot2` ou `mot3`) sont présents (sinon on décompte dans `niveau2absent` et puis `niveau3absent`), et s'ils sont au-dessus d'un pourcentage à déterminer (supposons `30`) (sinon on décompte dans `niveau2pourcentage`).
  Cela pourrait donner quelque chose comme ça:
  ```
  pourcentage = 30
  niveau2pourcentage = 0
  niveau2absent = 0
  for niveau in niveau2:
      for wordsitem in wordsitems:
          if(niveau.wordsitem[0][0] == `niveau1.wordsitems[0][0]`):
              if(niveau.wordsitem[0][2] >= 30):
                  affichage()
              else:
                  niveau2pourcentage += 1
            elif(niveau.wordsitem[1][2] >= 30):
                    affichage()
                else:
                    niveau2pourcentage += 1
            elif(niveau.wordsitem[2][2] >= 30):
                    affichage()
                else:
                    niveau2pourcentage += 1
            else:
              niveau2absent += 1
  ```
